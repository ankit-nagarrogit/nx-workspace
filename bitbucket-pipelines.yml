image: node:18

options:
  size: 2x  # Increase if builds are heavy
  max-time: 15  # Max step time in minutes

pipelines:
  default:
    - step:
        name: Install dependencies
        caches:
          - node
        script:
          - npm ci
          - npx nx reset  # Optional, ensures clean daemon state
        artifacts:
          - node_modules/**

    - parallel:
        - step:
            name: Build affected apps
            caches:
              - node
            script:
              - npm ci
              - echo "Building affected apps..."
              - npx nx affected --target=build --base=origin/main --head=HEAD

        - step:
            name: Lint affected apps
            caches:
              - node
            script:
              - npm ci
              - echo "Linting affected apps..."
              - npx nx affected --target=lint --base=origin/main --head=HEAD