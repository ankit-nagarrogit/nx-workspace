image: node:18

pipelines:
  branches:
    main:
      - step:
          name: Install dependencies
          caches:
            - node
          script:
            - echo "üîß Installing dependencies..."
            - npm ci
            - npx nx reset
          artifacts:
            - node_modules/**

      - parallel:
          - step:
              name: Simulate deploy- first-app
              script:
                - >
                  echo "üöÄ Checking affected projects for first-app...";
                  AFFECTED=$(npx nx show projects --affected --base=origin/main --head=HEAD);
                  echo "Affected projects: $AFFECTED";
                  if echo "$AFFECTED" | grep -q first-app; then
                    echo "‚úÖ first-app is affected. Building and deploying...";
                    npx nx build first-app;
                    npm run deploy:first;
                  else
                    echo "‚ùå No changes in first-app ‚Äî skipping.";
                  fi

          - step:
              name: Simulate deploy- second-app
              script:
                - >
                  echo "üöÄ Checking affected projects for second-app...";
                  AFFECTED=$(npx nx show projects --affected --base=origin/main --head=HEAD);
                  echo "Affected projects: $AFFECTED";
                  if echo "$AFFECTED" | grep -q second-app; then
                    echo "‚úÖ second-app is affected. Building and deploying...";
                    npx nx build second-app;
                    npm run deploy:second;
                  else
                    echo "‚ùå No changes in second-app ‚Äî skipping.";
                  fi
